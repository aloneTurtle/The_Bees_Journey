#textdomain wesnoth-The_Bees_Journey

[scenario]
    id=04_To_the_Voyage
    name= _ "To the Voyage"

    next_scenario=05_Arrival_at_Lagos_Island
    map_file=04_To_the_Voyage.map

    victory_when_enemies_defeated=no

    {TURNS 20 18 16}
    {DEFAULT_SCHEDULE_DUSK}

    {SCENARIO_MUSIC "traveling_minstrels.ogg"}
    {EXTRA_SCENARIO_MUSIC "wesnoth-3.ogg"}
    {EXTRA_SCENARIO_MUSIC "breaking_the_chains.ogg"}

    [side]
        side=1
        controller=human
        team_name=heroes
        user_team_name= _ "team_name^Marie"

        type=Princess Bee
        id=Marie
        name= _ "Marie"
        unrenamable=yes
        canrecruit=yes

        recruit=Bee,Drone

        {FLAG_VARIANT long}
        {GOLD 140 120 100}
        {INCOME 4 2 0}
    [/side]

    [side]
        side=2
        controller=ai
        team_name=undead
        user_team_name= _ "team_name^Undead"

        type=Death Knight
        id=Ordin
        name= _ "Ordin"
        canrecruit=yes

        recruit=Walking Corpse,Skeleton,Skeleton Archer,Ghoul

        {FLAG_VARIANT undead}
        {GOLD 80 100 120}
        {INCOME 0 2 4}

        [ai]
            grouping=no
            recruitment_pattern=fighter,fighter,archer
            [goal]
                name=target
                [criteria]
                    id=Kaldyn
                [/criteria]
                value=8
            [/goal]
        [/ai]
    [/side]

    [side]
        side=3
        controller=ai
        team_name=wose
        user_team_name= _ "team_name^Wose"

        type=Elder Wose
        id=Tantondernintan
        name= _ "Tantondernintan"
        canrecruit=yes

        recruit=Wose Sapling,Wose

        {FLAG_VARIANT wood-elvish}
        {GOLD 100 120 140}
        {INCOME 0 2 4}

        [ai]
            grouping=no
            caution=0.2
            [goal]
                name=target
                [criteria]
                    id=Ordin
                [/criteria]
                value=8
            [/goal]
            [goal]
                name=target
                [criteria]
                    id=Kaldyn
                [/criteria]
                value=8
            [/goal]
        [/ai]
    [/side]

    {STARTING_VILLAGES 1 4}
    {STARTING_VILLAGES 2 4}
    {STARTING_VILLAGES 3 4}

    {SET_LABEL 23 18 ( _ "The Great Lake")}

    [event]
        name=prestart
        [objectives]
            [objective]
                description= _ "Move Kaldyn to the pier in the north"
                condition=win
            [/objective]

            [objective]
                description= _ "Death of Marie"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Noaille"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Dragochan"
                condition=lose
            [/objective]
            [objective]
                description= _ "Destruction of Kaldyn"
                condition=lose
            [/objective]

            {TURNS_RUN_OUT}

            [gold_carryover]
                bonus=yes
                carryover_percentage=40
            [/gold_carryover]
        [/objectives]

        [unit]
            type=Bone Shooter
            id=Guardian
            name= _ "Guardian"
            side=2
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
            x,y=14,14
            ai_special=guardian
        [/unit]

        [random_placement]
            num_items={ON_DIFFICULTY 2 4 6}
            variable=loc
            min_distance=2
            [filter_location]
                terrain=Ss
            [/filter_location]
            [command]
                [unit]
                    side=2
                    type=Walking Corpse
                    variation=swimmer
                    x,y=$loc.x,$loc.y
                    ai_special=guardian
                [/unit]
            [/command]
        [/random_placement]

        [unit]
            type=Wose Shaman
            side=3
            [modifications]
                {TRAIT_LOYAL_HERO_NOSLOT}
            [/modifications]
            x,y=4,3
        [/unit]

        #
        # The ship Kaldyn should board
        #

#ifver WESNOTH_VERSION >= 1.19.13
        {PLACE_IMAGE "scenery/boat.png" 24 2}
#else
        {PLACE_IMAGE "units/transport/boat.png" 24 2}
#endif

        # Clovis
        {PLACE_IMAGE "scenery/signpost.png" 11 13}

        [recall]
            id=Noaille
            x,y=4,23
        [/recall]
        [recall]
            id=Dragochan
            x,y=3,22
        [/recall]
        [recall]
            id=Mal Kaldyn
            x,y=4,22
        [/recall]

        {MODIFY_UNIT (side=1) facing ne}
    [/event]

    [event]
        name=start

        # Remove Mal from his ID as well
        [modify_unit]
            [filter]
                id=Mal Kaldyn
            [/filter]
            id=Kaldyn
        [/modify_unit]

        [message]
            speaker=narrator
            message= _ "The party reached the port on the island."
            image=wesnoth-icon.png
        [/message]
        [message]
            speaker=Kaldyn
            message= _ "Heading northeast from here will take you to Lagos Island."
        [/message]
        [message]
            speaker=Noaille
            message= _ "Very well, then we must leave from here in haste. We have no time to spare."
        [/message]
        [message]
            speaker=Kaldyn
            message= _ "Wait! You might be able to fly, but I can’t. So how am I supposed to cross the sea?"
        [/message]
        [message]
            speaker=Dragochan
            message= _ "Why don’t you swim?"
        [/message]
        [message]
            speaker=Kaldyn
            message= _ "No way. But you could carry—"
        [/message]
        [message]
            speaker=Dragochan
            message= _ "(<i>death stare</i>) ..."
        [/message]
        [message]
            speaker=Kaldyn
            message= _ "I’d like to go by ship. YES! I’d love to ride in the boat! I mean, that is why we came to this port. Haha... gulp."
        [/message]
        [message]
            speaker=Marie
            message= _ "Be quiet for a moment. There seems to be some commotion over there."
        [/message]
        [message]
            speaker=Tantondernintan
            message= _ "Evil creatures ravaging our forest! This is your last day!"
        [/message]
        [message]
            speaker=Ordin
            message= _ "You rotten piece of wood. If you can do it, do it."
        [/message]
        [message]
            speaker=Kaldyn
            message= _ "What the hell is going on? Skeleton, explain."
        [/message]
        [message]
            speaker=Ordin
            message= _ "Whoa, are you my former master? Dear Kaldyn, I refuse to serve such a ridiculous fool who surrenders to insects smaller than yourself."
        [/message]
        [message]
            speaker=Dragochan
            message= _ "Haha, it seems you’ve lost all respect. Or did he harbor resentment against you all along?"
        [/message]
        [message]
            speaker=Kaldyn
            message= _ "Umm... Skeleton, we must head to Lagos Island via the port near you. If you can understand, don’t interfere."
        [/message]
        [message]
            speaker=Ordin
            message= _ "How aggravating! You third-rate sorcerer, I’ll destroy you without a trace!"
        [/message]
        [message]
            speaker=Tantondernintan
            message= _ "You too."
        [/message]

        {HIGHLIGHT_IMAGE 23 3 items/gohere.png ()}
    [/event]

    [event]
        name=turn 3
        [message]
            speaker=Dragochan
            message= _ "<i>Marie... I still can’t shake my concern about that lich. I truly feel indebted to you and want to help you on your journey. His case, however, is simply that he wants to save himself.</i>"
        [/message]
        [message]
            speaker=Marie
            message= _ "<i>That’s probably true right now... But I don’t see him as truly evil. He might be able to regain something he lost.</i>"
        [/message]
        [message]
            speaker=Dragochan
            message= _ "<i>You are too gentle as one who shall become queen... But I see. I’ll keep an eye on him, but nothing more.</i>"
        [/message]
    [/event]

    [event]
        name=turn 4
        [message]
            speaker=Marie
            message= _ "<i>Come to think of it, Noaille, you mentioned something I didn’t know during the battle with Kaldyn; that the undead carved a wound into your heart. What exactly happened? Does my mother have anything to with it?</i>"
        [/message]
        [message]
            speaker=Noaille
            message= _ "<i>It happened before you were born, and it’s no big deal. I have nothing worth telling.</i>"
        [/message]
        [message]
            speaker=Marie
            message= _ "<i>Well, that’s fine then.</i>"
        [/message]
    [/event]

    [event]
        name=moveto

        [filter]
            side=1
            x,y=11,13
        [/filter]

        [message]
            speaker=narrator
            message= _ "<i>To the Undead or Wose: <b>Go away.</b> There’s nothing for you here.</i>"
            image=scenery/signpost.png
        [/message]
    [/event]
    [event]
        name=capture

        [filter]
            side=1
            x,y=10,11
        [/filter]

        [message]
            speaker=unit
            message= _ "Who are you standing there?"
        [/message]

        #
        # Return of the early-version character
        #

        [unit]
            type=Elvish Lord
            id=Clovis
            name= _ "Clovis"
            profile="portraits/elves/captain.webp"
            unrenamable=yes
            [modifications]
                {TRAIT_DEXTROUS}
                {TRAIT_RESILIENT}

                {TRAIT_LOYAL}
                [+trait]
                    male_name=""
                    female_name=""
                [/trait]

                [object]
                    duration=forever
                    [effect]
                        apply_to=new_ability
                        [abilities]
                            [dummy]
                                id=firemaster
                                name= _ "firemaster"
                                female_name= _ "female^firemaster"
                                description= _ "Clovis is skilled in fire magic and can summon Fire Guardians anywhere without spending gold or upkeep. However, only two can be summoned on the map.

Note that summoned Fire Guardians will not be added to your recall list."
                            [/dummy]
                        [/abilities]
                    [/effect]
                [/object]

                {TEAM_COLOR_OVERRIDE () teal}
            [/modifications]
            side=1
            x,y=11,11
            animate=yes
        [/unit]

        #
        # Set the firemaster ability for Clovis
        #

        [set_menu_item]
            id=firemaster
            description= _ "Summon a Fire Guardian"
            [show_if]
                [have_unit]
                    x=$x1
                    y=$y1
                    id=Clovis
                [/have_unit]
            [/show_if]
            [command]
                [if]
                    [have_unit]
                        role=fire_puppet
                        count=2-99
                    [/have_unit]
                    [then]
                        [message]
                            speaker=narrator
                            message= _ "You cannot summon more than two!"
                            image=wesnoth-icon.png
                        [/message]
                    [/then]
                    [else]
                        {STORE_UNIT (id=Clovis) temp no}
                        [sound]
                            name=magic-faeriefire.ogg
                        [/sound]
                        [unit]
                            type=Fire Guardian
                            role=fire_puppet
                            side=1
                            moves=0
                            attacks_left=0
                            resting=no
                            x=$temp.x
                            y=$temp.y
                            passable=yes
                            animate=yes
                            [modifications]
                                {TRAIT_LOYAL}
                            [/modifications]
                        [/unit]
                        {CLEAR_VARIABLE temp}
                    [/else]
                [/if]
            [/command]
        [/set_menu_item]

        [message]
            speaker=Clovis
            message= _ "This is surprising, a speech-wielding bee has come to visit me. I am Clovis, the last elf on this island, called the Firemaster."
        [/message]
        [message]
            speaker=Dragochan
            message= _ "Finding an elf here is unexpected, but convenient. Those trees are allies of the elves, correct? Please tell them to cease their attacks against us."
        [/message]
        [message]
            speaker=Clovis
            message= _ "No, they are my enemies. They treated me like a madman, and a few weeks ago, they even drove me out of the forest. How utterly rude! I merely used them in my experiments a little, in pursuit of truth..."
        [/message]
        [message]
            speaker=Dragochan
            message= _ "I see. <small>I’d better not ask about the experiment details...</small>"
        [/message]
        [message]
            speaker=Clovis
            #po: Clovis has not yet realized this lich is Kaldyn (see S10 for their past)
            message= _ "But are you bringing a necromancer? If you possess the wisdom to understand words, you should know that they are the kind of people you shouldn’t get involved with."
        [/message]
        [message]
            speaker=Noaille
            message= _ "He’s merely a guide. Of course, when he uses necromancy again, we’ll destroy him."
        [/message]
        [message]
            speaker=Clovis
            message= _ "Well, that’s not for me to interfere in. By the way, I have a request: might I accompany you as well? I was just about to move away from here, and you people are truly interesting."
        [/message]
        [message]
            speaker=Marie
            message= _ "You are welcome, but only on the condition that you do NOT use us as experimental materials..."
        [/message]
        [message]
            speaker=narrator
            message= _ "Clovis is skilled in fire magic and can summon Fire Guardians anywhere without spending gold or upkeep. However, only two can be summoned on the map.

Note that summoned Fire Guardians will not be added to your recall list."
            image=wesnoth-icon.png
        [/message]

        {ACHIEVE s04}
    [/event]

    [event]
        name=moveto

        [filter]
            id=Kaldyn
            [filter_location]
                x,y=23,18
                radius=12
            [/filter_location]
        [/filter]

        [message]
            speaker=Kaldyn
            message= _ "This lake..."
        [/message]
        [message]
            speaker=Noaille
            message= _ "What a big lake. Do you know this?"
        [/message]
        [message]
            speaker=Kaldyn
            message= _ "After I washed ashore on this island, I found this lake almost immediately. I remember feeling it was incredibly beautiful. But this will likely be the last time I ever see this lake."
        [/message]
        [message]
            speaker=Noaille
            message= _ "... If you still have even a shred of lingering feelings, you can go there. You have that right."
        [/message]
        [message]
            speaker=Kaldyn
            message= _ "..."
        [/message]
    [/event]

    #
    # Kaldyn alone can possess
    #

    {PICKUPPABLE_ITEM necklace_of_life 25 19 (
        id=Kaldyn
    ) items/ankh-necklace2.png
    _"This necklace grants healing magic. Should $unit.name take it?"
    _"necklace of life^Take it"
    _"necklace of life^Leave it"
    _"Only Kaldyn can take this item." (
        [object]
            name= _ "Necklace of Life"
            image=items/ankh-necklace2.png
            duration=forever
            description= _ "The magic of this necklace allows the wearer to heal the wounds of other units and provides self-healing every turn."
            [effect]
                apply_to=new_ability
                [abilities]
                    {ABILITY_CURES}
                    {ABILITY_REGENERATES}
                [/abilities]
            [/effect]
            [effect]
                apply_to=new_animation
                [healing_anim]
                    start_time=-300
                    [frame]
                        image="units/undead-necromancers/lich-magic-[1,2].png:75"
                    [/frame]
                    [frame]
                        image="units/undead-necromancers/lich-magic-3.png"
                        halo=halo/holy/halo[6,1~6].png:75
                    [/frame]
                    [frame]
                        image="units/undead-necromancers/lich-magic-[2,1].png:50"
                    [/frame]
                    [frame]
                        image="units/undead-necromancers/lich.png:1"
                    [/frame]
                [/healing_anim]
            [/effect]
        [/object]

        {FADE_OUT_MUSIC}

        [hide_unit]
            [not]
                id=Kaldyn
            [/not]
        [/hide_unit]

        {FADE_TO_BLACK}

        # Kaldyn's monologue

        [message]
            speaker=Kaldyn
            message= _ "... You truly treasured this necklace, my little sister."
        [/message]

        {REPLACE_SCENARIO_MUSIC "breeze.ogg"}
        {APPEND_MUSIC "elvish-theme.ogg"}

        [message]
            speaker=Kaldyn
            message= _ "How many centuries have passed since then? You and I were exiled from our home island and washed here. In truth, you were not to blame. It was I who dabbled in darkness, half out of curiosity. Yet you abandoned everything to go with me."
        [/message]
        [message]
            speaker=Kaldyn
            message= _ "If you hadn’t been with me, you never would have been killed."
        [/message]
        [message]
            speaker=Kaldyn
            message= _ "I cursed the islanders who killed you. But still, the one I hate most is myself. Had I not fallen into depravity, you would have lived a peaceful life."
        [/message]

        {DELAY 1000}

        [message]
            speaker=Kaldyn
            message= _ "I may soon be doomed. I have no idea what awaits me after leaving this hateful island. I must entrust myself to that mysterious bee named Marie."
        [/message]
        [message]
            speaker=Kaldyn
            message= _ "Meeting you in the Land of the Dead would be terrifying beyond words. When that time comes, however, I will find some way to return this necklace to you. So please forgive me, Flora..."
        [/message]

        {FADE_IN}

        [unhide_unit]
        [/unhide_unit]

        {DELAY 750}

        [message]
            speaker=Noaille
            message= _ "Are you satisfied now?"
        [/message]
        [message]
            speaker=Kaldyn
            message= _ "Sure, thank you. This lake is the only beautiful spot on this island."
        [/message]
    )}

    [event]
        name=last breath

        [filter]
            id=Ordin
        [/filter]

        [message]
            speaker=unit
            message= _ "Argh! In the end... I could not even surpass Kaldyn..."
        [/message]
    [/event]
    [event]
        name=last breath

        [filter]
            id=Tantondernintan
        [/filter]
        [filter_second]
            side=1
        [/filter_second]

        [message]
            speaker=unit
            message= _ "What the hell are you who attacking us?"
        [/message]
        [message]
            speaker=Marie
            message= _ "We are bees, creatures that love nature! We bear you no ill will. If you do not hinder us, we will do nothing to you."
        [/message]
        [message]
            speaker=unit
            message= _ "... I’ll believe your words. Sorry for mistreating you as enemies without hearing your side. We’ll take a little rest."
        [/message]

        [kill]
            side=3
            fire_event=no
        [/kill]

        [if]
            [have_unit]
                id=Clovis
            [/have_unit]
            [then]
                [message]
                    speaker=Clovis
                    message= _ "They seem to have finally realized their mistake!"
                [/message]
                [message]
                    speaker=Dragochan
                    message= _ "Hey elf, don’t show yourself to them; it’ll only make things more troublesome."
                [/message]
            [/then]
        [/if]
    [/event]

    [event]
        name=moveto

        [filter]
            id=Kaldyn
            x,y=23,3
        [/filter]

        [message]
            speaker=Kaldyn
            message= _ "Now we can get on the boat. You might want to rest your wings during the voyage."
        [/message]

        [endlevel]
            result=victory
            bonus=yes
            {NEW_GOLD_CARRYOVER 40}
        [/endlevel]
    [/event]
[/scenario]
