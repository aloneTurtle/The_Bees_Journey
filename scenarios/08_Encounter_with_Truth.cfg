#textdomain wesnoth-The_Bees_Journey

[scenario]
    id=08_Encounter_with_Truth
    name= _ "Encounter with Truth"

    next_scenario=09_Reunion
    map_file=08_Encounter_with_Truth.map

    {TURNS 28 26 24}
    {DEFAULT_SCHEDULE_DUSK}

    {INTRO_AND_SCENARIO_MUSIC "revelation.ogg" "breeze.ogg"}
    {EXTRA_SCENARIO_MUSIC "loyalists.ogg"}
    {EXTRA_SCENARIO_MUSIC "journeys_end.ogg"}

    [story]
        [part]
            title= _ "<i><b>The Bee’s Journey</b></i>"
#ifver WESNOTH_VERSION >= 1.19.17
            title_position=center,middle
#endif
        [/part]
        [part]
            title= _ "<i>Volume III: <b>Her Last Smile</b></i>"
#ifver WESNOTH_VERSION >= 1.19.17
            title_position=center,middle
#endif
        [/part]
        [part]
            background="data/campaigns/The_Rise_Of_Wesnoth/images/story/trow_intro_05.webp"
            story= _ "On the eve of landing on Gapas Island, the hornets launched a surprise assault on the party. Caught in the swirling vortex of the assassin swarm, the battered boat shattered into pieces, and Dragochan and Kaldyn were swept away by the raging waves. The bees resisted the siege, but could not stop the two from being tossed by the sea and pulled far away."
        [/part]
        [part]
            story= _ "Marie and the bees escaped with their lives and clung to the wreckage, trembling as the peril passed. As morning faded and evening approached, they reached the coast of Gapas Island..."
            show_title=yes
        [/part]
    [/story]

    [side]
        side=1
        controller=human
        team_name=heroes
        user_team_name= _ "team_name^Marie"

        type=Princess Bee
        id=Marie
        name= _ "Marie"
        unrenamable=yes
        canrecruit=yes

        recruit=Bee,Drone

        {FLAG_VARIANT long}
        {GOLD 160 140 120}
        {INCOME 6 4 2}
    [/side]

    [side]
        side=2
        controller=ai
        team_name=enemies
        user_team_name= _ "team_name^Hornets"

        type=Great Hornet
        id=Diala
        name= _ "Diala"
        canrecruit=yes

        recruit=Assault Hornet,Ghost,Wraith,Hornet,Warrior Hornet

        {FLAG_VARIANT6 ragged}
        {GOLD 120 140 160}
        {INCOME 8 12 14}

        [ai]
            grouping=offensive
            aggression=0.6
            recruitment_pattern=fighter,fighter,scout,mixed fighter
            [goal]
                name=target
                [criteria]
                    id=Fersen
                [/criteria]
                value=8
            [/goal]
        [/ai]
    [/side]

    [side]
        side=3
        controller=ai
        team_name=heroes
        user_team_name= _ "team_name^Fersen"

        no_leader=yes

        recruit=Hornet,Reverend Hornet

        color=teal
        {GOLD 120 100 80}
        {INCOME 6 4 2}

        [ai]
            grouping=no
            passive_leader=yes
            recruitment_pattern=fighter,healer,healer
            [goal]
                name=protect_unit
                [criteria]
                    id=Fersen
                [/criteria]
                value=4
            [/goal]
        [/ai]
    [/side]

    [side]
        side=4
        controller=ai
        team_name=heroes
        user_team_name= _ "team_name^Fersen"

        no_leader=yes
        hidden=yes

        color=teal

        {KAMIKAZE_AI ()}
    [/side]

    [side]
        side=5
        controller=ai
        team_name=enemies
        user_team_name= _ "team_name^Hornets"

        type=Great Hornet
        id=Jophin
        name= _ "Jophin"
        canrecruit=yes

        recruit=Assault Hornet,Walking Corpse,Hornet,Warrior Hornet

        {FLAG_VARIANT6 ragged}
        {GOLD 120 140 160}
        {INCOME 4 8 10}

        [ai]
            grouping=offensive
            aggression=0.8
            caution=0.2
            recruitment_pattern=fighter,fighter,fighter,mixed fighter,mixed fighter
            [goal]
                name=target
                [criteria]
                    id=Fersen
                [/criteria]
                value=4
            [/goal]
        [/ai]
    [/side]

    {RECRUIT_UNIT_VARIATIONS 5 "Walking Corpse" ant,spider}

    {STARTING_VILLAGES_ALL 5}
    {STARTING_VILLAGES 1 5}
    {STARTING_VILLAGES 2 7}

    [event]
        name=prestart
        [objectives]
            [objective]
                description= _ "Defeat both enemy leaders"
                condition=win
            [/objective]

            [objective]
                description= _ "Death of Marie"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Noaille"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Fersen"
                condition=lose
            [/objective]

            {TURNS_RUN_OUT}

            [gold_carryover]
                bonus=yes
                carryover_percentage=40
            [/gold_carryover]
        [/objectives]

        [sound_source]
            id=wardrums
            sounds=ambient/wardrums.ogg
            x,y=34,10
            loop=-1
        [/sound_source]

        #
        # Hornets in mid-battle
        #
        {GENERIC_UNIT 2 (Assault Hornet) 36 7}
        {GENERIC_UNIT 4 (Hornet) 35 8}

        {GENERIC_UNIT 2 (Assault Hornet) 30 9}
        {GENERIC_UNIT 4 (Hornet) 29 10}

        {GENERIC_UNIT 2 (Wraith) 34 10}
        {GENERIC_UNIT 4 (Reverend Hornet) 33 11}

        {GENERIC_UNIT 2 (Warrior Hornet) 25 3}
        {GENERIC_UNIT 4 (Hornet) 25 4}

        {GENERIC_UNIT 2 (Warrior Hornet) 29 12}
        {GENERIC_UNIT 4 (Hornet) 28 12}

        # Other enemies
        {GENERIC_UNIT 2 (Assault Hornet) 35 3}
        {GENERIC_UNIT 2 (Wraith) 38 6}
#ifndef EASY
        {GENERIC_UNIT 2 (Ghost) 37 12}
        {GENERIC_UNIT 2 (Ghost)  27 2}
#endif

        # Other allies
#ifndef HARD
        {GENERIC_UNIT 4 (Cardinal Hornet) 26 11}
#endif
        {GENERIC_UNIT 4 (Reverend Hornet)  21 7}
        {GENERIC_UNIT 4 (Reverend Hornet) 25 14}

        {MODIFY_UNIT (side,canrecruit=2,no) upkeep loyal}

        # Weaken ally hornets
        {MODIFY_UNIT (side=4) hitpoints ({ON_DIFFICULTY 28 24 18})}

        #
        # To the Reunion scenario
        #
        {STORE_UNIT (id=Dragochan) Dragochan_store yes}
        {STORE_UNIT (id=Kaldyn) Kaldyn_store yes}

        [recall]
            id=Noaille
            x,y=4,2
        [/recall]
        [recall]
            id=Imorin
            x,y=3,4
        [/recall]
        [recall]
            id=Yoshie
            x,y=4,3
        [/recall]

        {MODIFY_UNIT (side=1,3,4) facing ne}
        {MODIFY_UNIT (side=2,5) facing sw}
    [/event]

    [event]
        name=start

        [message]
            speaker=narrator
            message= _ "Even upon finally arriving at Gapas Island, their hearts could not find peace."
            image=wesnoth-icon.png
        [/message]
        [message]
            speaker=Noaille
            message= _ "This island seems far too unnatural. Despite being the middle of winter, it’s warm enough for the snow to start melting. Could it be because of the magic the ants had mentioned?"
        [/message]
        [message]
            speaker=Marie
            message= _ "Perhaps someone is using magic to reshape the nature here to suit their own convenience. If Kaldyn were here, he might tell us something about this kind of magic..."
        [/message]

        [if]
            [have_unit]
                # wmllint: recognize Clovis
                id=Clovis
                search_recall_list=yes
            [/have_unit]
            [then]
                [recall]
                    id=Clovis
                    x,y=2,3
                [/recall]

                [message]
                    speaker=Clovis
                    message= _ "Marie, I’ve carefully searched the entire coastline just to be sure, but Dragochan and the lich are still nowhere to be found. I’m disappointed I can’t bring you better news."
                [/message]
                [message]
                    speaker=Marie
                    message= _ "Thank you, Clovis. I never imagined you’d go this far for us."
                [/message]
                [message]
                    speaker=Clovis
                    message= _ "Ha ha, just a small token of thanks for letting me observe you all the time."
                [/message]
            [/then]
            [else]
                [role]
                    # Not including Elder Bee to avoid similarity with Noaille
                    role=advisor
                    type=Sunshine Bee,King Bee,Worker Bee,Fire Bee,Priest Bee,Bee,Drone
                    [auto_recall]
                        x,y=2,3
                    [/auto_recall]

                    [else]
                        [unit]
                            side=1
                            type=Bee
                            role=advisor
                            x,y=2,3
                            animate=yes
                        [/unit]
                    [/else]
                [/role]

                [message]
                    role=advisor
                    message= _ "We searched the coastline, but found no sign of Dragochan and Kaldyn."
                [/message]
                [message]
                    speaker=Marie
                    message= _ "Thanks for the report."
                [/message]
            [/else]
        [/if]

        [message]
            speaker=narrator
            message= _ "<small>Don’t let him escape!</small>"
            image=none
        [/message]

        [move_unit_fake]
            side=3
            # This is intentional; no halo
            type=Reverend Hornet
            x=24,23,22,21,20,19,18,17,16,15
            y=11,11,11,12,11,12,12,13,13,14
        [/move_unit_fake]
        [unit]
            type=Cardinal Hornet
            id=Fersen
            name= _ "Fersen"
            unrenamable=yes
            canrecruit=yes
            side=3
            x,y=15,14
            facing=ne
        [/unit]

        [capture_village]
            side=3
            x=15
            y=11
        [/capture_village]
        [capture_village]
            side=3
            x=12
            y=14
        [/capture_village]

        [message]
            speaker=Fersen
            message= _ "Looks like you failed to kill me again."
        [/message]
        [message]
            speaker=Fersen
            message= _ "My comrades, at least hear me out. We must put an end to this senseless carnage. Otherwise, without exception, everyone will be doomed."
        [/message]
        [message]
            speaker=Diala
            message= _ "Shut up, traitor! You failed to understand our lady and rebelled. That alone makes you worthy of death!"
        [/message]
        [message]
            speaker=Jophin
            message= _ "Consider being killed by our lady’s decree your only solace!"
        [/message]
        [message]
            speaker=Fersen
            message= _ "I have no intention of dying yet... I must free you from her bonds."
        [/message]
        [message]
            speaker=Marie
            message= _ "Why is that hornet being attacked by his own kind? I have no idea what’s going on."
        [/message]
        [message]
            speaker=Noaille
            message= _ "Marie, if we save him, we might gain some clues from him. Of course, it’s not certain he’s on our side yet, but we have no better option right now."
        [/message]
        [message]
            speaker=Marie
            message= _ "That might be right."
        [/message]
        [message]
            speaker=Diala
            message= _ "Hey, look at the western coast! The bees are camping out!"
        [/message]
        [message]
            speaker=Fersen
            message= _ "Bees? Ah, how fortunate. It seems the assassins failed..."
        [/message]
        [message]
            speaker=Marie
            message= _ "I have something I must ask you. But first, your dangerous comrades need to clear out of here. Fight alongside us for a while."
        [/message]
        [message]
            speaker=Fersen
            message= _ "I... understand."
        [/message]

        # Not moving immediately
        {MODIFY_UNIT (side=2,4,5) moves 0}
    [/event]

    {FORCE_CHANCE_TO_HIT (side=4) () 0 ()}

    [event]
        name=recruit
        [filter]
            side=2,5
            race=undead
        [/filter]

        {DELAY 250}

        [message]
            speaker=Fersen
            message= _ "What good comes from violating such a taboo?"
            scroll=no
        [/message]
        [message]
            side=$side_number
            canrecruit=yes
            message= _ "Our lady has given us new wisdom and strength. Why can’t you understand!"
        [/message]
    [/event]

    [event]
        name=turn 2
        [message]
            speaker=Marie
            message= _ "They summoned the undead... How did those hornets acquire knowledge of necromancy?"
        [/message]
        [message]
            speaker=Noaille
            message= _ "<i>They are... No way...</i>"
        [/message]
        [message]
            speaker=Marie
            message= _ "Noaille, are you feeling unwell? You turned pale as a spirit."
        [/message]
        [message]
            speaker=Noaille
            message= _ "No, I was just recalling a little about the past! Truly nothing to speak of."
        [/message]
        [message]
            speaker=Marie
            message= _ "... Is that REALLY not a big deal for you?"
        [/message]
    [/event]

    [event]
        name=turn 7
        [message]
            speaker=Diala
            message= _ "Why can’t you even win, you cowards! Call for reinforcements!"
        [/message]
        [message]
            speaker=Jophin
            message= _ "Kill the traitor and the bees!"
        [/message]

        [gold]
            side=2,5
            amount=100
        [/gold]
    [/event]

    # TODO: Each enemy's last breath event (low-priority)

    [event]
        name=enemies defeated

        [message]
            speaker=Noaille
            message= _ "They began to retreat. For now, it seems fair to consider this a victory."
        [/message]

        [store_time_of_day]
            variable=current_time
        [/store_time_of_day]

        [if]
            [variable]
                name=current_time.id
                equals="morning"
            [/variable]
            [then]
                {ACHIEVE s08}
            [/then]
            [elseif]
                [variable]
                    name=current_time.id
                    equals="afternoon"
                [/variable]
                [then]
                    {ACHIEVE s08}
                [/then]
            [/elseif]
        [/if]

        {CLEAR_VARIABLE current_time}

        [endlevel]
            result=victory
            bonus=yes
            {NEW_GOLD_CARRYOVER 40}
        [/endlevel]
    [/event]

    [event]
        name=victory

        #
        # After-victory cutscene
        #

        {FADE_OUT_MUSIC}

        [remove_sound_source]
            id=wardrums
        [/remove_sound_source]

        [hide_unit]
        [/hide_unit]

        {PUT_TO_RECALL_LIST (
            [not]
                id=Marie,Noaille,Fersen
            [/not]
        )}

        {FADE_TO_BLACK}

        {TELEPORT_UNIT (id=Marie) 18 15}
        {TELEPORT_UNIT (id=Noaille) 19 15}

        {FULL_HEAL (side=1,3)}

        {MODIFY_UNIT (side=1) facing nw}
        {MODIFY_UNIT (side=3) facing se}

        {DELAY 250}

        [message]
            speaker=narrator
            message= _ "After a while, Marie and Noaille began their meeting with Fersen."
            image=wesnoth-icon.png
        [/message]

        [scroll_to]
            x,y=15,14
        [/scroll_to]

        {FADE_IN}

        [unhide_unit]
            id=Marie,Noaille,Fersen
        [/unhide_unit]

        [redraw][/redraw]

        {REPLACE_SCENARIO_MUSIC "underground.ogg"}

        {DELAY 750}

        [message]
            speaker=Fersen
            message= _ "First, I must offer my thanks to you, the bees. My name is Fersen, a cardinal of the hornets, and I am now a fugitive from my own kind."
        [/message]
        [message]
            speaker=Marie
            message= _ "How long have you hornets occupied this island? I can’t believe this is your permanent home."
        [/message]
        [message]
            speaker=Fersen
            message= _ "At least several months ago, though I can’t say for certain. The magic Valois created blurred some of our memories before we even realized. But it’s clear we’ve changed this island profoundly. We destroyed nature, frantically plastered mortar onto the ground, and killed countless creatures. We had totally lost sight of ourselves."
        [/message]
        [message]
            speaker=Marie
            message= _ "... Just who is Valois anyway?"
        [/message]
        [message]
            speaker=Fersen
            message= _ "She is the master of the hornets, a sorceress known as Lady Valois. We had previously lost our great queen. Then she suddenly appeared and demanded we worship her as the new queen. Strangely, she seemed appealing to us. With no other leader to rely on, we accepted her in the end."
        [/message]
        [message]
            speaker=Fersen
            message= _ "She led us while ensnaring us, gradually devouring our very will. Yet we could not doubt her. She constantly sought power for some purpose of her own, and eventually set her gaze on Gapas Island. Valois and we invaded the island in a swarm, seizing its heart."
        [/message]
        [message]
            speaker=Noaille
            message= _ "..."
        [/message]
        [message]
            speaker=Fersen
            message= _ "By the time we realized, it was already too late. On a rainy day, we had a nightmare. She revived the magical energy left in the island’s heart and fused it with an evil power, unleashing it all over the island. The island was now mastered by her darkness. Only then did I and a few hornets realize our souls had been controlled by her..."
        [/message]
        [message]
            speaker=Fersen
            message= _ "Yet most still served her, and their worship swelled greater with each passing day."
        [/message]
        [message]
            speaker=Marie
            message= _ "You rebelled against her and tried to end her rule. But you failed, I suppose?"
        [/message]
        [message]
            speaker=Fersen
            message= _ "That’s true... My strength was nowhere near enough to take her down."
        [/message]

        {DELAY 750}

        [message]
            speaker=Marie
            message= _ "We must smash the heart of Gapas Island and corner Valois ― to confirm why she unleashed this accursed tragedy, and to end it at once. If we fail, a peaceful tomorrow will never dawn for us again."
        [/message]
        [message]
            speaker=Marie
            message= _ "... Noaille, are you listening?"
        [/message]

        {FADE_OUT_MUSIC}

        {REPLACE_SCENARIO_MUSIC "love_theme.ogg"}

        [message]
            speaker=Noaille
            message= _ "<i>Oh my... Melissa... So this is what you entrusted me with... You really...</i>"
        [/message]
        [message]
            speaker=Marie
            message= _ "Noaille?"
        [/message]
        [message]
            speaker=Noaille
            message= _ "<i>Melissa... I certainly... I...</i>"
        [/message]
        [message]
            speaker=Marie
            message= _ "What are you saying, <b>Noaille!</b>"
        [/message]

        [sound]
            name=magic-faeriefire.ogg
        [/sound]

        {FLASH_WHITE ()}

        [message]
            speaker=Marie
            message= _ "... Noaille, you’re surely hiding something from me, aren’t you?"
        [/message]
        [message]
            speaker=Noaille
            message= _ "That’s just overthinking."
        [/message]
        [message]
            speaker=Marie
            message= _ "When you saw the hornets summoned the undead, and heard the enemy’s name, your face clearly paled. Back on Kaldyn’s island, you’d said some strange things too. Noaille, are you perhaps... aware of something about the source of our crisis?"
        [/message]
        [message]
            speaker=Noaille
            message= _ "..."
        [/message]
        [message]
            speaker=Marie
            message= _ "Well, if you can’t speak to me now, that’s no problem. I trust you."
        [/message]
        [message]
            speaker=Noaille
            message= _ "... I’m sorry, Marie..."
        [/message]
        [message]
            speaker=Fersen
            message= _ "The heart lies northeast of here, surrounded by the mountains. It is protected from outside intrusion by the wastes, and of course, there are numerous guards of Valois. We managed to sneak close to her mansion, but that was as far as we could go."
        [/message]
        [message]
            speaker=Fersen
            message= _ "Young queen, if you wish, we shall join your forces and aid you in battle."
        [/message]
        [message]
            speaker=Marie
            message= _ "It won’t be good for either of us. We’ve suffered much grief because of you hornets. Even if the true evil is solely Valois, we can’t erase our feelings against you... You stay and guard this area for a while. So that if we fail, at least those remaining will have a chance to escape."
        [/message]
        [message]
            speaker=Fersen
            message= _ "Fair enough. However, brave queen, at least allow me to present you with this sword. It is a treasure our former queen held dear."
        [/message]

        {THUNDER ()}

        [object]
            id=marie_moonblade
            name= _ "Moonblade"
            image=items/sword-holy.png
            duration=forever
            description= _ "The Moonblade is a mighty sword forged by magic, which also increases the wearer’s defense."
            [filter]
                id=Marie
            [/filter]
            [effect]
                apply_to=new_ability
                [abilities]
                    [dummy]
                        id=moonblade
                        name= _ "moonblade"
                        female_name= _ "female^moonblade"
                        description= _ "The Moonblade is a mighty sword forged by magic, which also increases the wearer’s defense."
                    [/dummy]
                [/abilities]
            [/effect]
            [effect]
                apply_to=attack
                name=sword
                set_type=arcane
                set_icon=attacks/sword-holy.png
                [set_specials]
                    mode=append
                    {WEAPON_SPECIAL_MAGICAL}
                [/set_specials]
                set_attacks=5
            [/effect]
            [effect]
                apply_to=defense
                replace=yes
                [defense]
                    {FLY_DEFENSE 40}
                    cave=40
                    fungus=30
                    deep_water=50
                    swamp_water=50
                    forest=30
                    mountains=30
                    village=30
                    castle=30
                    frozen=50
                [/defense]
            [/effect]
        [/object]

        [message]
            speaker=Fersen
            message= _ "But you must handle this treasure with the utmost care. If you unlock this sword’s magic with too strong a will, it risks birthing a fearsome power capable of destroying even your being. If used with enough caution, the sword shall protect you as your finest weapon."
        [/message]
        [message]
            speaker=Marie
            message= _ "Thank you, Fersen. I’ll keep fighting until we all can talk like this in friendship."
        [/message]
        [message]
            speaker=Fersen
            message= _ "Me too."
        [/message]

        [hide_unit]
            id=Fersen
        [/hide_unit]

        {PUT_TO_RECALL_LIST (
            id=Fersen
        )}

        [redraw][/redraw]

        [message]
            speaker=Noaille
            message= _ "..."
        [/message]

        {DELAY 750}

        [message]
            speaker=Noaille
            message= _ "However... Dragochan and Kaldyn still haven’t returned to us. How can we rescue them?"
        [/message]
        [message]
            speaker=Marie
            message= _ "Don’t worry. The two will surely return on their own soon. We’ve journeyed together and fought side by side all this time. I believe in my friends, nothing more."
        [/message]
        [message]
            speaker=Noaille
            message= _ "... You’ve truly grown stronger, Marie; you never had that kind of certainty before. But that’s precisely why I sometimes find myself scared..."
        [/message]

        {DELAY 250}
    [/event]
[/scenario]
